function object(d){var s=function(){};s.prototype=d;return new s();}(function($){var d=function(f,g){f=$(f);var h={},j=true,k=-1,l=false,m,n,o,p=false,r,t;if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){if(Number(RegExp.$1)<=7){p=true;}}r=$('<div class="'+g.resultsClass+'" style="display:block;position:absolute"></div>').hide();t=$('<iframe />');t.css({border:'none',position:'absolute'});if(g.width>0){r.css("width",g.width);t.css("width",g.width);}$('body').append(r);if(p){$('body').append(t);}var u=function(G){return G.label||(typeof(G)==='string'?G:G[0])||'';};var v=function(G){return G.values||(G.value?[G.value]:(typeof(G)==='string'?[G]:G))||[];};var w={quicksilver:function(q,G){q=q.toLowerCase();h[q]=[];for(var i=0;i<G.length;i++){if(u(G[i]).toLowerCase().score(q)>0){h[q].push(G[i]);}}return h[q].sort(function(a,b){a=u(a).toLowerCase().score(q);b=u(b).toLowerCase().score(q);return(a>b?-1:(b>a?1:0));});},contains:function(q,G){q=q.toLowerCase();h[q]=[];for(var i=0;i<G.length;i++){if(u(G[i]).toLowerCase().indexOf(q)>-1){h[q].push(G[i]);}}return h[q].sort(function(a,b){a=u(a).toLowerCase();b=u(b).toLowerCase();return(a.indexOf(q)>b.indexOf(q)?-1:(a.indexOf(q)<b.indexOf(q)?1:(a>b?-1:(b>a?1:0))));});},startsWith:function(q,G){q=q.toLowerCase();h[q]=[];for(var i=0;i<G.length;i++){if(u(G[i]).toLowerCase().indexOf(q)===0){h[q].push(G[i]);}}return h[q].sort(function(a,b){a=u(a).toLowerCase();b=u(b).toLowerCase();return(a>b?-1:(b>a?1:0));});}};var x={store:function(q,G){G(g.data);},ajax:function(q,G){var H=g.ajax+"?q="+encodeURI(q);for(var i in g.ajaxParams){if(g.ajaxParams.hasOwnProperty(i)){H+="\x26"+i+"\x3d"+encodeURI(g.ajaxParams[i]);}}$.getJSON(H,G);}};var y=function(G){var H=$('li',r);if(!H){return;}if(typeof(G)==="number"){k=k+G;}else{k=H.index(G);}if(k<0){k=0;}else{if(k>=H.size()){k=H.size()-1;}}H.removeClass(g.selectedClass);$(H[k]).addClass(g.selectedClass);if(g.autoFill&&this.last_keyCode!=8){f.val(n+$(H[k]).text().substring(n.length));var I=n.length,J=f.val().length,K=f.get(0);if(K.createTextRange){var L=K.createTextRange();L.collapse(true);L.moveStart("character",I);L.moveEnd("character",J);L.select();}else if(K.setSelectionRange){K.setSelectionRange(I,J);}else if(K.selectionStart){K.selectionStart=I;K.selectionEnd=J;}K.focus();}};var z=function(){if(o){clearTimeout(o);}f.removeClass(g.loadingClass);if(r.is(":visible")){r.hide();}if(t.is(":visible")){t.hide();}};var A=function(G,H){if(!G){G=document.createElement("li");G.item='';}var I=u(G.item),J=v(G.item);f.lastSelected=I;f.val(I);n=I;r.empty();g.additional_fields.each(function(i,K){K.value=J[i+1];});if(!H){z();}if(g.onItemSelect){setTimeout(function(){g.onItemSelect(G);},1);}return true;};var B=function(){var G=$("li."+g.selectedClass,r).get(0);if(G){return A(G);}else{if(g.exactMatch){f.val('');g.additional_fields.each(function(i,H){$(H).val('');});}return false;}};var C=function(G){r.empty();if(!l||G===null||G.length===0){return z();}var H=document.createElement("ul"),I=G.length,J=function(){y(this);},K=function(){},L=function(e){e.preventDefault();e.stopPropagation();A(this);};r.append(H);if(g.maxVisibleItems>0&&g.maxVisibleItems<I){I=g.maxVisibleItems;}for(var i=0;i<I;i++){var M=G[i],N=document.createElement("li");r.append(N);$(N).text(g.formatItem?g.formatItem(M,i,I):u(M));N.item=M;if(M.className){N.className=M.className;}H.appendChild(N);$(N).hover(J,K).click(L);}f.removeClass(g.loadingClass);};var D=function(q,G){x[!g.data?'ajax':'store'](q,function(H){C(w[g.matchMethod](q,H));G();});};var E=function(){var G=f.offset(),H=(g.width>0?g.width:f.width()),I=$('li',r);r.css({width:parseInt(H,10)+"px",top:G.top+f.height()+5+"px",left:G.left+"px"});if(p){t.css({width:parseInt(H,10)-2+"px",top:G.top+f.height()+6+"px",left:G.left+1+"px",height:r.height()-2+'px'}).show();}r.show();if(g.autoSelectFirst||(g.selectSingleMatch&&I.length==1)){y(I.get(0));}};var F=function(){if(m>=9&&m<=45){return;}var q=f.val();if(q==n){return;}n=q;if(q.length>=g.minChars){f.addClass(g.loadingClass);D(q,E);}else{if(q.length===0&&(g.onBlank?g.onBlank():true)){g.additional_fields.each(function(i,G){G.value='';});}f.removeClass(g.loadingClass);r.hide();t.hide();}};r.mousedown(function(e){j=e.srcElement.tagName!='DIV';});f.keydown(function(e){m=e.keyCode;switch(e.keyCode){case 38:e.preventDefault();y(-1);break;case 40:e.preventDefault();if(!r.is(":visible")){E();y(0);}else{y(1);}break;case 13:if(B()){e.preventDefault();f.select();}break;case 9:B();break;case 27:if(k>-1&&g.exactMatch&&f.val()!=$('li',r).get(k).text()){k=-1;}$('li',r).removeClass(g.selectedClass);z();e.preventDefault();break;default:if(o){clearTimeout(o);}o=setTimeout(F,g.delay);break;}}).focus(function(){l=true;}).blur(function(e){if(j){if(k>-1){B();}l=false;if(o){clearTimeout(o);}o=setTimeout(function(){z();if(g.exactMatch&&f.val()!=f.lastSelected){A(null,true);}},200);}else{e.srcElement.focus();}});};$.fn.quickselect=function(f,g){f=f||{};f.data=(typeof(f.data)==="object"&&f.data.constructor==Array)?f.data:undefined;f.ajaxParams=f.ajaxParams||{};f.delay=f.delay||400;f.minChars=f.minChars||1;f.cssFlavor=f.cssFlavor||'quickselect';f.inputClass=f.inputClass||f.cssFlavor+"_input";f.loadingClass=f.loadingClass||f.cssFlavor+"_loading";f.resultsClass=f.resultsClass||f.cssFlavor+"_results";f.selectedClass=f.selectedClass||f.cssFlavor+"_selected";f.matchMethod=f.matchMethod||((typeof''.score==='function')&&'\x6c'.score('\x6c')==1?'quicksilver':'contains');if(f.matchCase===undefined){f.matchCase=false;}if(f.exactMatch===undefined){f.exactMatch=false;}if(f.autoSelectFirst===undefined){f.autoSelectFirst=true;}if(f.selectSingleMatch===undefined){f.selectSingleMatch=true;}if(f.additional_fields===undefined){f.additional_fields=$('nothing');}f.maxVisibleItems=f.maxVisibleItems||-1;if(f.autoFill===undefined||f.matchMethod!='startsWith'){f.autoFill=false;}f.width=parseInt(f.width,10)||0;this.each(function(){var h=this,j=object(f);if(h.tagName=='INPUT'){d(h,j);}else if(h.tagName=='SELECT'){j.delay=j.delay||10;var name=h.name,k=h.id,l=h.className,m=$(h).attr('accesskey'),n=$(h).attr('tabindex'),o=$("option:selected",h).get(0);j.data=[];$('option',h).each(function(i,t){j.data.push({label:$(t).text(),values:[t.value,t.value],className:t.className});});var p=$("<input type='text' class='"+l+"' id='"+k+"_quickselect' autocomplete='off' accesskey='"+m+"' tabindex='"+n+"' />");if(o){p.val($(o).text());}var r=$("<input type='hidden' id='"+k+"' name='"+h.name+"' />");if(o){r.val(o.value);}j.additional_fields=r;$(h).after(p).after(r).remove();p.quickselect(j);}});};})(jQuery);